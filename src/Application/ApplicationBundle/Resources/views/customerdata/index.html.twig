{% extends 'AppApplicationBundle:Default:new_base.html.twig'%}

{% block stylesheet %}	
        <meta charset="UTF-8" />
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link href="{{ asset('public/pages/css/AppApplicationBundle/index.css') }}" rel="stylesheet"/>
        <link href="{{ asset('plugins/flat-admin-bootstrap-templates-master/dist/html/assets/css/vendor.css') }}" rel="stylesheet"/>
        <link rel="icon" type="image/x-icon" href="{{ asset('favicon.ico') }}" />
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/font-awesome/css/font-awesome.min.css">
    <!-- Fontastic Custom icon font-->
    <link rel="stylesheet" href="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/css/fontastic.css">
    <!-- Google fonts - Poppins -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,700">
    <!-- Bootstrap Select CSS-->
    <link rel="stylesheet" href="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/bootstrap-select/css/bootstrap-select.min.css">
    <!-- Bootstrap Touchspin CSS-->
    <link rel="stylesheet" href="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/bootstrap-touchspin/jquery.bootstrap-touchspin.min.css">
    <!-- Bootstrap Datepicker CSS-->
    <link rel="stylesheet" href="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/bootstrap-datepicker/css/bootstrap-datepicker3.css">
    <!-- Bootstrap Tags input CSS-->
    <link rel="stylesheet" href="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/bootstrap-tagsinput/bootstrap-tagsinput.css">
    <!-- No UI Slider-->
    <link rel="stylesheet" href="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/nouislider/nouislider.css">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/css/style.default.premium.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/img/favicon.ico">

{% endblock %}

{% block body %} 
{% include 'AppApplicationBundle::customerdata/ipdetails.html.twig'  %}


    <section class="forms">
        <div class="container-fluid">
          <!-- Page Header-->
          <header> 
            <h1 class="h3 display">Customer Data Entity</h1>
          </header>
          <div class="row">
            <div class="col-lg-12">
              <div class="card">
                <div class="card-header d-flex align-items-center">
                  <h4>Customer Data Entity</h4>
                </div>
                <div class="card-body">
                  <div>
                   <button id="testCustDataCollection" type="button"  class="btn btn-primary">Export Data</button>
                   <button type="button" data-toggle="modal" data-target="#product_new" class="btn btn-primary" disabled>Add Data</button>
                  </div>
                  <div class="table-responsive" style="margin-top:35px;">
                    <div id="datatable1_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4 no-footer" style="padding-left:0px;padding-right:0px;">
                      <div class="row">
                        <div class="col-md-12 col-md-6">
                          <div class="dataTables_length" id="datatable1_length">
                            <table id="datatable1" style="width: 100%;" class="table dataTable no-footer" role="grid" aria-describedby="datatable1_info">
                              <thead>
                                <th style="width:15%">Customer Email</th>
                                <th style="width:15%">IP Addres</th>
                                <th style="width:25%">Cookie Id</th>
                                <th style="width:25%">Action</th>
                                <th style="width:20%"></th>
                               
                              </thead>
                              <tbody>
                                {% for customer in customers %}
                                    <tr>
                                        <td style="width:15%"><a>{{ customer.email  }}</a></td>
                                        <td style="width:15%">{{ customer.ipAddress }}</td>
                                        <td style="width:25%">{{ customer.CookieId}}</script></td>
                                        <td style="width:25%">{{ customer.action}}</td>
                                        <td style="width:20%"><i class="fas fa-database" aria-hidden="true" id="{{customer.id}}" data-toggle="modal" data-target="#ipdetails"></i><i class="fas fa-table delete_new" aria-hidden="true" id="{{customer.id}}" data-toggle="modal" data-target="#enDetails" style="margin-left:20px;"></i></a></td>
                                {% endfor %}
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
               </div>
              </div>
        </div>
      </section>
<div id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" class="modal fade text-left" style="display: none;" aria-hidden="true">
                    <div role="document" class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 id="exampleModalLabel" class="modal-title">Export Product Data</h5>
                          <button type="button" data-dismiss="modal" aria-label="Close" class="close"><span aria-hidden="true">Ã—</span></button>
                        </div>
                        <div class="modal-body">
                          <p>Date Range</p>
                          <form>
                            <div class="form-group">
                              <label>Start Date</label>
                             <input type="text" class="form-control input-datepicker" data-provide="datepicker" >
                            </div>
                            <div class="form-group">       
                              <label>End Date</label>
                              <input type="text"  class="form-control input-datepicker" data-provide="datepicker" >
                            </div>
                            <div class="form-group">       
                              <input type="submit" value="Signin" class="btn btn-primary">
                            </div>
                          </form>
                        </div>
                        <div class="modal-footer">
                          <button type="button" data-dismiss="modal" class="btn btn-secondary">Close</button>
                          <button id="testj" type="button" class="btn btn-primary">Save changes</button>
                        </div>
                      </div>
                    </div>
                  </div>

{% endblock %}
{% block javascript %}
    <!-- JavaScript files-->
    <script src="{{ asset('plugins/vendor_new/jquery/jquery.min.js') }}"></script>
    <script src="{{ asset('plugins/vendor_new/popper.js/umd/popper.min.js') }}"> </script>
    <script src="{{ asset('plugins/vendor_new/bootstrap/js/bootstrap.min.js') }}"></script>
    <script src="{{ asset('plugins/js_new/grasp_mobile_progress_circle-1.0.0.min.js') }}"></script>
    <script src="{{ asset('plugins/vendor_new/jquery.cookie/jquery.cookie.js') }}"> </script>
    <script src="{{ asset('plugins/vendor_new/jquery-validation/jquery.validate.min.js') }}"></script>
    <script src="{{ asset('plugins/vendor_new/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js') }}"></script>
    <script src="{{ asset('plugins/js_new/charts-custom.js') }}"></script>
    <script src="{{ asset('plugins/js_new/entityJs.js') }}"></script>


 <!-- Bootstrap Touchspin-->
    <script src="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js"></script>
    <!-- Bootstrap No UI Slider-->
    <script src="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/nouislider/nouislider.min.js"></script>
    <!-- Bootstrap DatePicker-->
    <script src="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.js"></script>

     <!-- Data Tables-->
     <script src="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/js/tables-datatable.js"></script>

    <script src="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/datatables.net/js/jquery.dataTables.js"></script>
    <script src="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/datatables.net-bs4/js/dataTables.bootstrap4.js"></script>
    <script src="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="https://d19m59y37dris4.cloudfront.net/admin-premium/1-4-3/vendor/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <!-- Main File-->
    <script src="{{ asset('plugins/js_new/front.js') }}"></script>
    <script>
      $('document').ready(function(){
        console.log("Test data")

        $('#testCustDataCollection').click(function(){
          console.log("Test data successfull");
          var custEntity = {'email':'charlesaz@gmail.com','cookie':'947845','ipAddress':'yr7434989'};
          getIP();
        });

        
        
      });

      function getCustomerEntity(email,phone,data){
       
        console.log("ipV4"+ data.ip)
        var clientId = '123';
        var email = email;
        var phone = phone;
        var ipAddress = data.ip;
        var provider = data.connection.organization;
        var ipEntity = JSON.stringify(data)
        var dataEntity = {
          'email':email,
          'phone':phone,
          'ipAddress':ipAddress,
          'cookie':clientId,
          'provider': provider,
          'ipEntity':ipEntity
        }

        console.log("data"+dataEntity);
        retrieveCustomerDataCollection(dataEntity);
        return dataEntity;
      }

      function getIP(){
        $.getJSON('https://api.ipregistry.co/?key=xdgrgqz0uye9hr', function(data) {
          data = data
          return getCustomerEntity("","7482",data);
        });
      }

      function getIPEntity(){
        $.getJSON('https://api.ipregistry.co/?key=xdgrgqz0uye9hr', function(data) {
          data = data
          $("#modalclose").empty();
          $("#modalclose").append('<code>'+JSON.stringify(data, null, 10)+'</code>');
        });
      }

      $(".fas.fa-database").click(function(){
        var idCustomerEntity = $(this).attr("id");
        getIPEntityDetails(idCustomerEntity)
      });

      $(".fas.fa-table.delete_new").click(function(){
        var idCustomerEntity = $(this).attr("id");
        getDetailsEntity(idCustomerEntity)
      });

      function getDetailsEntity(idCustomerEntity){
         	$.ajax({
    			url: "{{ path('customerdata_getDetailsEntity') }}",
    		    async: true,
    		    type: "GET",
            dataType: "json",
    		    data: { "idCustomerEntity": idCustomerEntity },	
    		    contentType: "application/json"               
                	                
            })
            .done(function (data) {

              $("#emailEntityValue").val(data.message[1]);
              $("#phoneEntityValue").val(data.message[0]);
              $("#cookieEntityValue").val(data.message[3]);
              $("#userIdEntityValue").val(data.message[5]);
              $("#deviceEntityValue").val(data.message[8]);

				      console.log("details Entity "+data.message);
            })
            .fail(function (jqXHR, textStatus, errorThrown) {
            });
      }

      function retrieveCustomerDataCollection(customerData){
          console.log(customerData.email);
    		  	$.ajax({
    			url: "{{ path('customerdata_collectCustData') }}",
    		    async: true,
    		    type: "GET",
            dataType: "json",
    		    data: { "customerData": JSON.stringify(customerData) },	
    		    contentType: "application/json"               
                	                
            })
            .done(function (data) {

            
				console.log("point "+data.message);
            })
            .fail(function (jqXHR, textStatus, errorThrown) {
				points = "fail";
            });
		} 

    function getIPEntityDetails(idCustomerEntity){
      console.log("fdaasdf")
      $.ajax({
    			url: "{{ path('customerdata_getPublicEntity') }}",
    		    async: true,
    		    type: "GET",
            dataType: "json",
    		    data: { "idCustomerEntity": idCustomerEntity },	
    		    contentType: "application/json"               
                	                
            })
            .done(function (data) {

            $("#modalclose").empty();
				 $("#modalclose").append('<code>'+data.message+'</code>');
            })
            .fail(function (jqXHR, textStatus, errorThrown) {
				points = "fail";
            });
    }


    </script>
    {% endblock %}

